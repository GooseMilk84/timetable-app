<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Timetable</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(90deg, #4165b4, #ffffff);
            color: rgba(44, 44, 46, 0.8);
            min-height: 100vh;
            padding: 20px 16px;
            overflow: hidden;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            width: 90%;               
            max-width: 400px;         
            min-width: 300px;         
            height: auto;           
            max-height: 90vh;
            margin: 5vh auto;
            background: rgba(8, 8, 34, 0.8);
            border-radius: 16px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overscroll-behavior: contain;
            padding: 20px;            
        }

        .header {
            background: linear-gradient(135deg, #27276e, #0b0b3d);
            padding: 24px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            border-radius: 16px;
        }

        .nav-arrows {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-arrows:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-50%) scale(1.1);
        }

        .nav-arrows:active {
            transform: translateY(-50%) scale(0.95);
        }

        .nav-arrows.left {
            left: 20px;
        }

        .nav-arrows.right {
            right: 20px;
        }

        .arrow {
            width: 0;
            height: 0;
            border-style: solid;
        }

        .arrow.left {
            border-right: 8px solid rgba(255, 255, 255, 0.8);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        .arrow.right {
            border-left: 8px solid rgba(255, 255, 255, 0.8);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        .current-day {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #007AFF, #5AC8FA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .current-time {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }

        .timetable {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: calc(100vh - 200px);
            max-height: 480px;
            overflow-y: auto;
        }

        .lesson {
            background: rgba(58, 58, 60, 0.6);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .lesson:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .lesson.current {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.2), rgba(255, 149, 0, 0.2));
            border: 1px solid rgba(255, 204, 0, 0.4);
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.2);
        }

        .lesson.next {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.2), rgba(90, 200, 250, 0.2));
            border: 1px solid rgba(0, 122, 255, 0.4);
            box-shadow: 0 0 20px rgba(0, 122, 255, 0.2);
        }

        .lesson-time {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .lesson.current .lesson-time {
            color: rgba(255, 204, 0, 1);
        }

        .lesson.next .lesson-time {
            color: rgba(90, 200, 250, 1);
        }

        .lesson-subject {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            color: rgba(255, 255, 255, 0.8);
        }

        .lesson-teacher {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .lesson-room {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        .no-lessons {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
        }

        @media (max-height: 667px) {
            .timetable {
                height: calc(100vh - 160px);
            }
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="nav-arrows left" id="prevDay">
                <div class="arrow left"></div>
            </div>
            <div class="current-day" id="currentDay">Monday</div>
            <div class="current-time" id="currentTime">09:00</div>
            <div class="nav-arrows right" id="nextDay">
                <div class="arrow right"></div>
            </div>
        </div>
        <div class="timetable" id="timetable">
            <!-- Lessons will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // Sample timetable data - you can modify this to match your actual schedule
        const timetableData = {
            monday: [
                { time: '09:10-10:00', subject: 'Enterprise (GCSEF)', teacher: 'Victoria Bevan', room: 'P7' },
                { time: '10:00-10:50', subject: 'Enterprise (GCSEF)', teacher: 'Victoria Bevan', room: 'P7' },
                { time: '11:10-12:00', subject: 'English', teacher: 'Emily Dempsey', room: 'L5' },
                { time: '12:50-13:40', subject: 'Science', teacher: 'Helen Darron', room: 'C1' },
                { time: '13:40-14:30', subject: 'Science', teacher: 'Andrew Molyneux', room: 'C8' },
                { time: '14:30-15:20', subject: 'Maths', teacher: 'Johanna Downing-Green', room: 'D5' }
            ],
            tuesday: [
                { time: '09:10-10:00', subject: 'Business Studies', teacher: 'Victoria Bevan', room: 'P7' },
                { time: '10:00-10:50', subject: 'Business Studies', teacher: 'Victoria Bevan', room: 'P7' },
                { time: '11:10-12:00', subject: 'Computer Science', teacher: 'Terry Alty', room: 'L9' },
                { time: '12:50-13:40', subject: 'Maths', teacher: 'Johanna Downing-Green', room: 'D5' },
                { time: '13:40-14:30', subject: 'Science', teacher: 'Amy Shelton', room: 'C9' },
                { time: '14:30-15:20', subject: 'English', teacher: 'Victoria McGoldrick', room: 'S1' }
            ],
            wednesday: [
                { time: '09:10-10:00', subject: 'PE (Double)', teacher: 'Craig Hardie', room: 'None' },
                { time: '10:00-10:50', subject: 'PE (Dobule)', teacher: 'Craig Hardie', room: 'None' },
                { time: '11:10-12:00', subject: 'Science', teacher: 'Andrew Molyneux', room: 'C2' },
                { time: '12:50-13:40', subject: 'RE', teacher: 'Myke Hunter', room: 'Y4' },
                { time: '13:40-14:30', subject: 'Computer Science', teacher: 'Terry Alty', room: 'L9' },
                { time: '14:30-15:20', subject: 'Computer Science', teacher: 'Terry Alty', room: 'L9' }
            ],
            thursday: [
                { time: '09:00-09:45', subject: 'ICT', teacher: 'Laura Sherrington', room: 'L2' },
                { time: '09:45-10:30', subject: 'ICT', teacher: 'Laura Sherrington', room: 'L2' },
                { time: '10:45-11:30', subject: 'Maths', teacher: 'Johanna Downing-Green', room: 'D5' },
                { time: '11:30-12:15', subject: 'Science', teacher: 'Amy Shelton', room: 'C4' },
                { time: '13:15-14:00', subject: 'English', teacher: 'Victoria McGoldrick', room: 'LS9' },
                { time: '14:00-14:45', subject: 'English', teacher: 'Victoria McGoldrick', room: 'LS9' }
            ],
            friday: [
                { time: '09:45-10:30', subject: 'Maths', teacher: 'Johanna Downing-Green', room: 'D5' },
                { time: '10:30-11:15', subject: 'English', teacher: 'Emily Dempsey', room: 'L5' },
                { time: '11:35-12:20', subject: 'Business Studies', teacher: 'Victoria Bevan', room: 'P7' },
                { time: '13:05-13:50', subject: 'Science', teacher: 'Helen Darron', room: 'C6' },
                { time: '13:50-14:35', subject: 'Enterprise (GCSEF)', teacher: 'Victoria Bevan', room: 'P7' },
                { time: '14:35-15:20', subject: 'ICT', teacher: 'Laura Sherrington', room: 'L2' }
            ]
        };

        const weekDays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
        let currentDisplayDay = 'monday';

        function getCurrentTimeInIsleOfMan() {
            const now = new Date();
            const options = {
                timeZone: 'Europe/Isle_of_Man',
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            return now.toLocaleTimeString('en-GB', options);
        }

        function getCurrentDayOfWeek() {
            const now = new Date();
            const options = {
                timeZone: 'Europe/Isle_of_Man',
                weekday: 'long'
            };
            return now.toLocaleDateString('en-GB', options).toLowerCase();
        }

        function navigateDay(direction) {
            const currentIndex = weekDays.indexOf(currentDisplayDay);
            let newIndex;
            
            if (direction === 'next') {
                newIndex = (currentIndex + 1) % weekDays.length;
            } else {
                newIndex = (currentIndex - 1 + weekDays.length) % weekDays.length;
            }
            
            currentDisplayDay = weekDays[newIndex];
            hasScrolledToCurrentLesson = false; // Reset scroll flag when changing days
            renderTimetable();
        }

        function parseTime(timeString) {
            const [hours, minutes] = timeString.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function getCurrentLesson(lessons, currentTime) {
            const currentMinutes = parseTime(currentTime.split(':').slice(0, 2).join(':'));
            
            for (let i = 0; i < lessons.length; i++) {
                const lesson = lessons[i];
                const [startTime, endTime] = lesson.time.split('-');
                const startMinutes = parseTime(startTime);
                const endMinutes = parseTime(endTime);
                
                if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                    return { current: i, next: i + 1 < lessons.length ? i + 1 : null };
                }
                
                if (currentMinutes < startMinutes) {
                    return { current: null, next: i };
                }
            }
            
            return { current: null, next: null };
        }

        // Test mode - set to true to always show highlighting regardless of day
        const TEST_MODE = true;
        
        function renderTimetable() {
            const actualCurrentDay = getCurrentDayOfWeek();
            const currentTime = getCurrentTimeInIsleOfMan();
            const timetableElement = document.getElementById('timetable');
            const currentDayElement = document.getElementById('currentDay');
            const currentTimeElement = document.getElementById('currentTime');

            currentDayElement.textContent = currentDisplayDay.charAt(0).toUpperCase() + currentDisplayDay.slice(1);
            currentTimeElement.textContent = currentTime;

            const lessons = timetableData[currentDisplayDay];
            
            if (!lessons) {
                timetableElement.innerHTML = '<div class="no-lessons">No lessons today</div>';
                return;
            }

            // In test mode, always check for highlighting. In normal mode, only highlight if viewing today
            const shouldHighlight = TEST_MODE || (actualCurrentDay === currentDisplayDay);
            const lessonStatus = getCurrentLesson(lessons, currentTime);
            const { current, next } = shouldHighlight ? lessonStatus : { current: null, next: null };

            console.log(`Displaying ${currentDisplayDay}, actual day: ${actualCurrentDay}`);
            console.log(`Test mode: ${TEST_MODE}, Should highlight: ${shouldHighlight}`);
            console.log(`Current lesson index: ${current}, Next lesson index: ${next}`);

            timetableElement.innerHTML = '';
            lessons.forEach((lesson, index) => {
                const lessonElement = document.createElement('div');
                lessonElement.className = 'lesson';
                
                if (index === current) {
                    lessonElement.classList.add('current');
                    console.log(`Added 'current' class to lesson ${index}: ${lesson.subject}`);
                } else if (index === next) {
                    lessonElement.classList.add('next');
                    console.log(`Added 'next' class to lesson ${index}: ${lesson.subject}`);
                }

                lessonElement.innerHTML = `
                    <div class="lesson-time">${lesson.time}</div>
                    <div class="lesson-subject">${lesson.subject}</div>
                    <div class="lesson-teacher">${lesson.teacher}</div>
                    <div class="lesson-room">${lesson.room}</div>
                `;

                timetableElement.appendChild(lessonElement);
            });

            // Auto-scroll removed - user can now scroll manually to view all lessons
        }

        function initializeApp() {
            // Set the current day
            const today = getCurrentDayOfWeek();
            if (weekDays.includes(today)) {
                currentDisplayDay = today;
            }

            // Initial render
            renderTimetable();

            // Update every second
            setInterval(renderTimetable, 1000);

            // Add click listeners
            document.getElementById('prevDay').onclick = function() {
                navigateDay('prev');
            };

            document.getElementById('nextDay').onclick = function() {
                navigateDay('next');
            };
        }

        // Run when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
